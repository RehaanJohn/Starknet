**Nimbus — StarkNet Vault & ChipiPay Dashboard**

This repository is a full-stack project combining a Next.js frontend/dashboard with StarkNet smart-contracts (Cairo / Scarb toolchain) and deployment scripts. The app integrates Braavos wallet for user on-chain connectivity and a ChipiPay-style vault contract that manages user balances and authorized hot-wallet withdrawals.

**Quick summary:**
- **Frontend:** `Next.js` + `React` + `Tailwind` (app dir). Uses `@clerk/nextjs` for auth and `@supabase/supabase-js` for data storage integrations.
- **On-chain logic:** `vault.cairo` implements a Vault contract with owner, hot wallet authorization, freeze/revoke features, and per-user Chipi balances.
- **Deployment:** TypeScript/Node scripts in `scripts/` to declare & deploy the contract to StarkNet and helper shell scripts for simpler flows.

**Tech stack:**
- **Next.js** (App Router)
- **React 19**, **TypeScript**, **TailwindCSS**, **Vitest** for tests
- **StarkNet** (Cairo contracts), `starknet` JS SDK
- **Clerk** for authentication, **Supabase** for auxiliary data

**Key features**
- **Wallet integration:** Braavos detection and connection on the client (`window.starknet_braavos`).
- **Chipi Wallet integration:** Gasless chipi-style wallet creation and on-chain vault interaction via API routes under `app/api/vault/*`.
- **Vault contract:** Owner-managed Vault with hot-wallet authorization, withdraw by hot wallet, freeze/unfreeze, and per-user Chipi balance storage (`contracts/vault.cairo`).
- **Deployment tooling:** `scripts/deploy_vault.ts` and shell wrappers to declare & deploy the contract and persist the deployed address to `.env.local`.

**Prerequisites**
- Node.js (recommend v20+)
- npm or yarn/pnpm
- A StarkNet account/private key & RPC endpoint (for deployments)

**Environment variables**
Create a `.env.local` (or set in your CI) with at least:

```
STARKNET_RPC_URL=...
STARKNET_ACCOUNT_ADDRESS=0x...
STARKNET_PRIVATE_KEY=...
VAULT_CONTRACT_ADDRESS=...    # written by deploy script after deployment
SUPABASE_URL=...              # optional if using Supabase
SUPABASE_ANON_KEY=...         # optional
CLERK_* (if using Clerk auth in production)
```

**Quick start (development)**

1. Install dependencies:

```bash
npm install
# or `pnpm install` / `yarn`
```

2. Run development server:

```bash
npm run dev
```

3. Open `http://localhost:3000`.

4. Edit `src/app/page.tsx` and the components in `src/components/` to iterate quickly.

**Running tests**

```bash
npm run test
```

**Deployment (contracts)**

The primary contract deploy script is `scripts/deploy_vault.ts`. It expects an account key and RPC URL in env vars. Example flow:

```bash
# set env vars (example)
export STARKNET_RPC_URL="https://starknet-sepolia.public.blastapi.io/rpc/v0_7"
export STARKNET_ACCOUNT_ADDRESS="0x..."
export STARKNET_PRIVATE_KEY="..."

# compile your Cairo contract (tooling depends on your environment, ensure compiled artifact at target/dev/vault_Vault.contract_class.json)
# then run deploy script
node ./scripts/deploy_vault.ts
```

The script appends the deployed contract address to `.env.local` as `VAULT_CONTRACT_ADDRESS` and verifies the contract owner via an on-chain call.

There are small helper scripts in `scripts/` for shell-based flows:
- `deploy_vault.sh`, `deploy_vault_simple.sh`, `deploy_vault_interactive.sh`, `deploy_vault_starkli.sh` — read and use the one that matches your deployment environment.

**Backend / API**

Server API routes are located under `src/app/api/` and include endpoints for:
- `vault/*` (authorize, set-balance, withdraw, freeze/unfreeze, status)
- `chipi-wallets/*` (create/fetch Chipi wallets via the Chipi provider)

These endpoints often rely on a bearer token from Clerk (`getToken`) and will call out to on-chain via the `starknet` JS provider or to the deployed Vault contract using `VAULT_CONTRACT_ADDRESS`.

**Contracts**

- Primary implementation: `contracts/vault.cairo` — owner-controlled vault with:
  - `authorize_hot` / `revoke` for hot wallet control
  - `withdraw_by_hot` restricted to the authorized hot wallet
  - `freeze` / `unfreeze` functionality
  - per-user `chipi_balance` storage and `set_chipi_balance` helper

When working with the Cairo contract, the repository expects compiled artifacts under `target/dev/` as generated by your Cairo toolchain (Scarb or StarkNet's compiler depending on your setup).

**Important code locations**
- Frontend pages/components: `src/app/`, `src/components/`
- Hooks: `src/hooks/` (`useVaultBalance`, `useBraavosBalance`, etc.)
- Stark helper functions: `src/lib/stark.ts`
- Deployment scripts: `scripts/*.ts`, `scripts/*.sh`

**Directory layout (high level)**
- `app/` — Next.js app router with pages, API routes.
- `src/lib/` — helper libs for StarkNet and Supabase.
- `contracts/` — Cairo source files (main vault contract).
- `scripts/` — deployment and helper scripts.

**Contributing**
- Please open issues or PRs describing the change.
- Keep changes focused: contract changes should include updated compiled artifacts or a clear compile step.

**Next steps & notes**
- If you want me to run the test suite or verify deployment in this environment, tell me which network and provide (securely) the necessary env vars or allow me to run the local deploy script.
- I consolidated many repo doc fragments (previous project MD files) into this single `README.md` for clarity. If you want any of those deleted docs restored separately, I can extract and add specific sections.

---

If you want, I can now:
- commit these changes and delete the removed files from git,
- run `npm run test`, or
- build and run the app locally.

Tell me which of the above you want next.
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
